<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
    
    <script src="../navigation.js"></script>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            text-align: center;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        h1 {
            color: #5cd65c;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #5cd65c50;
        }
        
        p {
            color: #ccc;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        
        canvas {
            border: 3px solid #5cd65c;
            margin-top: 20px;
            background: #0f0f23;
            box-shadow: 0 0 20px #5cd65c30;
            border-radius: 8px;
        }
        
        #score {
            font-size: 24px;
            margin-top: 20px;
            color: #5cd65c;
            font-weight: bold;
        }
        
        #nextPageButton {
            display: none;
            margin-top: 20px;
            background: linear-gradient(90deg, #5cd65c, #6de06d);
            color: #111;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 20px #5cd65c80;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }
        
        #nextPageButton:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px #5cd65c;
        }
        
        #passwordDisplay {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #16213e;
            border: 3px solid #5cd65c;
            color: #eee;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            max-width: 400px;
            box-shadow: 0 0 30px #5cd65c30;
        }
        
        #passwordDisplay span {
            color: #5cd65c;
        }
    </style>
</head>
<body>

<h1>Unncessary game of Snake to refocus you</h1>
<p style="font-size: 0.85em; color: #999; margin-top: -10px; margin-bottom: 15px;">(get a score of at least 5 to continue to the next page)</p>
<p>Use the arrow keys to control the snake and try to eat the food!</p>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<div id="score">Score: 0</div>
<div id="passwordDisplay">
    Password: <span id="dynamic-password">loading...</span>
</div>
<button id="nextPageButton" onclick="goToNextPage()">Next Page</button>

<script>
// Set up the canvas and context
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Game parameters
const gridSize = 20;
const canvasWidth = canvas.width;
const canvasHeight = canvas.height;
let score = 0;
let passwordShown = false; // Flag to track if password has been shown

// Snake game variables
let snake = [{ x: 100, y: 100 }];
let direction = 'right';
let food = {};

// Initialize game
function init() {
    score = 0;
    passwordShown = false; // Reset password shown flag
    snake = [{ x: 100, y: 100 }];
    direction = 'right';
    spawnFood();
    gameLoop();
}

// Draw the game elements (snake, food, score)
function draw() {
    // Clear the canvas
    ctx.clearRect(0, 0, canvasWidth, canvasHeight);

    // Draw the snake
    snake.forEach((segment, index) => {
        ctx.fillStyle = index === 0 ? 'green' : 'blue'; // Head is green, body is blue
        ctx.fillRect(segment.x, segment.y, gridSize, gridSize);
    });

    // Draw the food
    ctx.fillStyle = 'red';
    ctx.fillRect(food.x, food.y, gridSize, gridSize);

    // Display the score
    document.getElementById('score').textContent = `Score: ${score}`;
    
    // If the score is 5 or more, show the next page button and password
    if (score >= 5) {
        document.getElementById('nextPageButton').style.display = 'block';
        // Show password only once when first reaching score 5
        if (score >= 5 && !passwordShown) {
            showPasswordDisplay();
            passwordShown = true; // Set flag to prevent showing again
        }
    }
}

// Move the snake
function moveSnake() {
    const head = { ...snake[0] };

    switch (direction) {
        case 'up':
            head.y -= gridSize;
            break;
        case 'down':
            head.y += gridSize;
            break;
        case 'left':
            head.x -= gridSize;
            break;
        case 'right':
            head.x += gridSize;
            break;
    }

    // Check if the snake hits the wall or itself
    if (head.x < 0 || head.x >= canvasWidth || head.y < 0 || head.y >= canvasHeight || isCollidingWithSnake(head)) {
        return false; // Game over
    }

    snake.unshift(head); // Add new head
    if (head.x === food.x && head.y === food.y) {
        // Snake ate food (gain points)
        score += 1;
        spawnFood(); // Spawn new food
    } else {
        snake.pop(); // Remove tail
    }

    return true;
}

// Check if the snake's head collides with its body
function isCollidingWithSnake(head) {
    return snake.some(segment => segment.x === head.x && segment.y === head.y);
}

// Spawn a new food item at a random position
function spawnFood() {
    food = {
        x: Math.floor(Math.random() * (canvasWidth / gridSize)) * gridSize,
        y: Math.floor(Math.random() * (canvasHeight / gridSize)) * gridSize
    };
}

// Listen to arrow key inputs for controlling the snake
document.addEventListener('keydown', (event) => {
    if (event.key === 'ArrowUp' && direction !== 'down') direction = 'up';
    if (event.key === 'ArrowDown' && direction !== 'up') direction = 'down';
    if (event.key === 'ArrowLeft' && direction !== 'right') direction = 'left';
    if (event.key === 'ArrowRight' && direction !== 'left') direction = 'right';
});

// Main game loop
function gameLoop() {
    if (!moveSnake()) {
        alert('Game Over! Final Score: ' + score);
        init(); // Restart the game
        return;
    }
    draw();
    setTimeout(gameLoop, 100); // Repeat every 100ms
}

// Function to show password on page
function showPasswordDisplay() {
    // Get the next password dynamically
    let nextPassword = 'auth'; // fallback that should be correct
    
    try {
        console.log('Getting dynamic password for Snake game completion...');
        const levelInfo = window.getLevelInfo('snake.html');
        console.log('Level info:', levelInfo);
        if (levelInfo && levelInfo.next) {
            nextPassword = levelInfo.next.password;
            console.log('Next password from constants.js:', nextPassword);
        }
    } catch (error) {
        console.error('Error getting level info:', error);
    }
    
    // Display the password on the page
    document.getElementById('dynamic-password').textContent = nextPassword;
    document.getElementById('passwordDisplay').style.display = 'block';
    console.log('Dynamic password set to:', nextPassword);
}

// Function to handle "Next Page" button click
function goToNextPage() {
    window.location.href = "../password-portal/index.html"; // Go to password portal instead
}

// Start the game
init();
</script>
</body>
</html>
